{% extends "skeleton.html" %}
{% load static %}

{% block main %}

<!-- <div class="row">
        <div class="col s12 m6">
          <div class="card">
            <div class="card-image">
              <img src="images/sample-1.jpg">
              <span class="card-title">Card Title</span>
              <a class="btn-floating halfway-fab waves-effect waves-light red"><i class="material-icons">add</i></a>
            </div>
            <div class="card-content">
              <p>I am a very simple card. I am good at containing small bits of information. I am convenient because I require little markup to use effectively.</p>
            </div>
          </div>
        </div>
      </div> -->

    <div class="row">
        <div class="col s12 m4 offset-m4">
            <canvas class="z-depth-1" id="canvas_id" width="450" height="250"></canvas>        
            <div class="card darken-1" style="width: 450px;">
                <div class="card-image">
                    <div>                
                    </div>
                </div>
                <div class="card-action">
                    <a id='clear_canvas' href="#!" class="nlink waves-effect"><i class="material-icons">refresh</i></a>
                    <a id="submit_pic" class="nlink waves-effect" href="#!"><i class="material-icons">near_me</i></a>
                </div>
            </div>
        </div>
    </div>  


{% endblock %}
{% block additional_js %}
    {{ block.super }}
    <script>
        $(document).ready(function(){



            var colorPurple = "#cb3594";
            var colorGreen = "#659b41";
            var colorYellow = "#ffcf33";
            var colorBrown = "#986928";

            var curColor = colorGreen;
            var clickColor = new Array();


            var clickX = new Array();
            var clickY = new Array();
            var clickDrag = new Array();
            var paint;

            canvas = document.getElementById('canvas_id');
            context = canvas.getContext("2d");

            $('#submit_pic').on('click', function(){
                $.ajax({
                    method: 'post',
                    url: "{% url 'home' %}",
                    data: {
                        canvas: canvas.toDataURL()
                    },
                    success: function(){

                    }
                })
            });

            /* function resize(){    
                $("#canvas_id").outerHeight($(window).height()-$("#canvas_id").offset().top - Math.abs($("#canvas_id").outerHeight(true) - $("#canvas_id").outerHeight()));
            }
            resize();
            $(window).on("resize", function(){                      
                resize();
            }); */

            $('#clear_canvas').on('click', function(){
                context.clearRect(0, 0, canvas.width, canvas.height);
                clickX = new Array();
                clickY = new Array();
                clickDrag = new Array();
            });

            $('#canvas_id').mousedown(function(e){
                var mouseX = e.pageX - this.offsetLeft;
                var mouseY = e.pageY - this.offsetTop;
                      
                paint = true;
                addClick(e.pageX - this.offsetLeft, e.pageY - this.offsetTop);
                redraw();
              });

            $('#canvas_id').mousemove(function(e){
                if(paint){
                    addClick(e.pageX - this.offsetLeft, e.pageY - this.offsetTop, true);
                    redraw();
                }
            });

            $('#canvas_id').mouseup(function(e){
                paint = false;
            });

            $('#canvas_id').mouseleave(function(e){
                paint = false;
            });

            function addClick(x, y, dragging)
            {
                clickX.push(x);
                clickY.push(y);
                clickDrag.push(dragging);
            }

            function redraw(){
                context.clearRect(0, 0, context.canvas.width, context.canvas.height); // Clears the canvas
                
                context.strokeStyle = curColor;
                context.lineJoin = "round";
                context.lineWidth = 5;
                          
                for(var i=0; i < clickX.length; i++) {		
                    context.beginPath();
                    if(clickDrag[i] && i){
                        context.moveTo(clickX[i-1], clickY[i-1]);
                    }else{
                        context.moveTo(clickX[i]-1, clickY[i]);
                    }
                    context.lineTo(clickX[i], clickY[i]);
                    context.closePath();
                    context.stroke();
                }
            }


        });

    </script>
{% endblock %}